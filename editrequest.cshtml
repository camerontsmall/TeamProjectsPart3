@{
    Layout = "~/_Layout.cshtml";
    Page.Title = "Edit Request";
    Page.Path = "editrequest";
    Page.Parent = "Manage Requests";
    Page.ParentPath = "requests";
    var DB = Database.Open("dbConnectionString");
}
@if(Request.QueryString["delete"] != null){
    string deleteId = Request.QueryString["delete"];

    string reqquery = "DELETE FROM request WHERE request_id=@0";
    string roomquery = "DELETE FROM request_room WHERE request_id=@0";

    try {
        DB.Execute(reqquery, deleteId);
        DB.Execute(roomquery, deleteId);

        Response.Redirect("~/requests?message=delete=" + deleteId);
        Response.End();

    }catch(Exception e){
        <div class="card-panel red">Error: @e.Message</div>
    }


}

<h4>Edit Request @Request.QueryString["id"]</h4>
<div id="requestForm">
        <div class="row">
            <div class="col s12 m12 l6" id="form_left">
                <form method="post" action="./editrequest?id=@Request.QueryString["id"]">
                    <label for="titleinput">Module Code</label>
                    <select id="moduleinput" name="modulecode">
                        @RequestForm.Modules()
                    </select>
                    <br />
                    <label for="dayinput">Day</label>
                    <select id="dayinput" name="day">
                        @RequestForm.Days()
                    </select>
                    <br />
                    <label for="periodinput">Period(s)</label>
                    <select multiple id="periodinput" class="browser-default" name="period">
                        @RequestForm.Periods()
                    </select>
                    <br />
                    <label for="weeksinnput" class="active">Week(s)</label>
                    <select multiple id="weeksinput" class="browser-default" name="weeks">
                        @RequestForm.Weeks()
                    </select>
                    <label for="roomtypeinput">Preferred room type</label>
                    <select id="roomtypeinput" name="roomtype">
                        @RequestForm.RoomTypes()
                    </select>
                    <br />
                    <label for="parkinput">Preferred park</label>
                    <select id="parkinput" name="roompark" onchange="loadRooms()">
                        @RequestForm.Parks()
                    </select>
                    <br />
                    <label for="roominput">Preferred room</label>
                    <input list="roomlist" name="roompref" id="roominput" class="active" />
                    <datalist id="roomlist" name="room">
                        @RequestForm.Rooms()
                    </datalist>
                    <br />
                    <p>Required Facilities</p>
                    <div class="row">
                        @RequestForm.RoomFacilities()
                    </div>
                    <br />
                    <label for="specialinput">Special requirements</label>
                    <textarea id="specialinput" name="special" class="materialize-textarea" length="200"></textarea>
                    <input type="text" disabled name="owner" style="display:none;" value="@WebSecurity.CurrentUserId" />
                </form>
            </div>
            <div class="col s12 m12 l6" id="form-right">
                @{ 
                    var data = DB.Query("SELECT * FROM request_room WHERE request_id = @0", Request.QueryString["id"]);

                    List<Dictionary<string, string>> items = new List<Dictionary<string, string>>();

                    foreach (dynamic r in data) {
                        items.Add(Models.RoomRequest.ToNiceList(r));
                    }

                    var JSON = Json.Encode(items);

                }
                @JsonList.PrintList("roomlist", JSON, "Room Requests")
            </div>
        </div>
        <div class="row">
            <div class="col s12" id="form_buttons">
                <input class="btn waves-effect" type="submit" value="Submit" />
            </div>
        </div>
</div>